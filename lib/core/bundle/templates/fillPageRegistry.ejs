"use strict";

<%
var templatePath,
    classPath,
    dataLoaderPath;
%>

var pageRegistry = require("alamid/lib/shared/registries/pageRegistry.js"),
    Page = require("alamid/lib/client/Page.class.js"),
    pageBundle,
    pageDataLoader;

<% _(pages).each(function eachPage(page, pageURL)  {
    templatePath = page.template;
    classPath = page.Class;
    dataLoaderPath = page.dataLoader;

    if (classPath) { %>
pageBundle = require("bundle!<%= classPath %>");
    <% } else { %>
pageBundle = function loadTemplate(callback) {
    require("bundle!<%= templatePath %>")(function onTemplateLoaded(template) {
        callback(new Page({}, template));
    });
};
    <% }

    if (dataLoaderPath) { %>
pageDataLoader = require("<%= dataLoaderPath %>");
    <% } %>
pageRegistry.setPage("<%= pageURL %>", pageBundle, pageDataLoader);

<% }); %>