"use strict";

var alamidIndex = require("alamid/lib/index.js");

function initAlamid() {
    var Client = require("alamid/lib/client/Client.class.js"),
        MainPage = require("../app/pages/MainPage.class.js");

    alamidIndex.client = new Client(MainPage);
}

function initRegistries() {

    require("val!alamid/lib/core/bundle/fillPageRegistry.js");
    require("val!alamid/lib/core/bundle/fillServiceRegistry.js");
    require("val!alamid/lib/core/bundle/fillSchemaRegistry.js");
    require("val!alamid/lib/core/bundle/fillModelRegistry.js");
}

function initClient() {
    require("../app/init.client.js");
}

function initConfig() {

    var config = require("alamid/lib/shared/config.js");

    <% _(clientConfig).each(function assignClientConfigValue(value, key) { %>
    config[<%= JSON.stringify(key) %>] = <%= toSrc(value) %>;
    <% }); %>

    alamidIndex.config = config;
}

initConfig();
initAlamid();
initRegistries();
initClient();